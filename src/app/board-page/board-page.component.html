<md-spinner *ngIf="pageLoading" class="loading-spinner"></md-spinner>

<div class="block-xxl" *ngIf="!pageLoading">
  <h3 class="board-name">{{ (boardObj | async)?.name }}</h3>

  <div class="item-list-container">
    <div class="item-list"
         *ngFor="let column of (boardObj | async)?.cols; let columnID = index">
      <div class="item-list__title">
        <span>{{ column.title }}</span>
        <md-icon>{{ column.icon }}</md-icon>
      </div>

      <md-card *ngFor="let post of (boardObj | async).posts | keyobject | filterColumn: columnID; let i = index;"
               [style.background]="column.color"
               id="post-{{columnID}}-{{i}}"
               class="note pinned-note mat-elevation-z2">
        <img class="edit-icon"
             (click)="editEl = columnID + '-' + i"
             src="../../assets/images/marker.png"
             alt="edit note">

       <md-card-content>
          <span *ngIf="editEl !== columnID + '-' + i">
            {{post.value.val}}
          </span>

          <div *ngIf="editEl === columnID + '-' + i">
            <md-input-container class="full-width">
              <textarea mdInput
                        #postRef
                        class="new-item"
                        [ngModel]="post.value.val"
                        mdTextareaAutosize></textarea>
            </md-input-container>

            <button md-button
                    type="button"
                    name="update-post"
                    class="pin-me-btn"
                    (click)="updatePost(post, postRef)">
              Save
            </button>

            <button md-button
                    type="button"
                    name="update-post"
                    class="pin-me-btn"
                    (click)="discardChanges(post)">
              Discard
            </button>
          </div>
        </md-card-content>

        <md-card-footer>
          <p class="note-author">- {{post.value.author}}</p>
        </md-card-footer>
      </md-card>

      <md-card [style.background]="column.color"
               (mouseenter)="elevateCard(columnID)"
               (mouseleave)="removeElevation(columnID)"
               class="note unpinned-note mat-elevation-z10"
               [class.mat-elevation-z18]="isElevated(columnID)">
        <form (ngSubmit)="pushPost(newItem, columnID)"
              class="form">

          <md-input-container class="full-width">
            <textarea mdInput
                      #newItem
                      class="new-item"
                      placeholder="Write your feedback"
                      mdTextareaAutosize></textarea>
          </md-input-container>

          <button md-button
                  type="submit"
                  name="new-item"
                  class="pin-me-btn">
            Pin me
            <img class="pin-icon"
                 src="../../assets/images/pushpin.png"
                 alt="Pin me">
          </button>
        </form>
      </md-card>

    </div>
  </div>

  <md-card class="invite-collaborators">
    <md-card-title>
      Invite more collaborators to this board:
    </md-card-title>

    <md-card-content>
      <form [formGroup]="collaboratorsForm"
            (ngSubmit)="inviteCollaborator()"
            class="form"
            novalidate>
        <md-input-container class="full-width">
          <input mdInput
                 placeholder="Email address"
                 type="email"
                 name="collaborator"
                 formControlName="collaborator">
        </md-input-container>

        <md-card-actions align="end">
          <button md-raised-button
                  type="submit"
                  name="invite-collaborator"
                  [disabled]="!collaboratorsForm.valid || sendingInvite"
                  color="accent">
            <span>Invite</span>
            <md-spinner color="primary"
                        strokeWidth="8"
                        *ngIf="sendingInvite"
                        class="loading-spinner-bt"></md-spinner>
          </button>
        </md-card-actions>
      </form>
    </md-card-content>
  </md-card>

</div>
